---
title: Template Rendering
description: Render dynamic HTML pages with EJS templates
---
import { Code,FileTree } from '@astrojs/starlight/components';

StratusTS uses **`EJS (Embedded JavaScript)`** for rendering dynamic HTML pages. This guide covers everything you need to build server-side rendered applications.

## What is Template Rendering? 

**Template rendering** generates HTML dynamically on the server:
- Mix HTML with JavaScript
- Pass data from controllers to templates
- Create reusable layouts and components
- Build traditional web applications

## Setting Up Templates

### Configure Template Directory

In `src/settings.ts`:

<Code
  code={
    `const TEMPLATE_DIR = 'templates';`
  }
  lang='ts'
  title='src/settings.ts'
/>

This tells StratusTS where to find your templates.

### Create Template Directory

<Code
  code={
    `mkdir templates
mkdir templates/layouts
mkdir templates/partials
mkdir templates/pages`
  }
  lang='sh'
  title='terminal'
/>

**Structure:**

<FileTree>
- templates/
  - layouts/
    - base.ejs         # Main layout
  - partials/
    - header.ejs       # Reusable header
    - footer.ejs       # Reusable footer
  - pages/
    - home.ejs         # Home page
    - about.ejs        # About page
</FileTree>

## Your First Template

### Step 1: Create a Template

Create `templates/pages/home.ejs`:

<Code
  code={
    `<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome</title>
    </head>
    <body>
      <h1>Hello, World!</h1>
      <p>Welcome to StratusTS!</p>
    </body>
</html>`
  }
  lang='html'
  title='templates/pages/home.ejs'
/>

### Step 2: Render from Controller

<Code
  code={
    `import { type ControllerType } from 'stratus-ts';

const homeController: ControllerType = (question, reply) => {
    reply.render('pages/home.ejs');
};

export { homeController };`
  }
  lang='ts'
  title='app/controllers.ts'
/>

## Layouts

Layouts provide consistent structure across pages.

### Base Layout

Create `templates/layouts/base.ejs`:

<Code
  code={
    `<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title><%= title || 'My App' %></title>
      <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>
      <%- include('../partials/header') %>

      <main>
        <%- block main %>
      </main>

      <%- include('../partials/footer') %>

      <script src="/js/main.js"></script>
    </body>
</html>`
  }
  lang='html'
  title='layouts/base.ejs'
/>

### Using Layout

<Code
  code={
    `<%- layout("layouts/base",{
    title: 'home page'
}) %>

<% block main %>
    <h2>this is home page content</h2>
<% block main end %>`
  }
  lang='html'
  title='pages/home.ejs'
/>

## Partials

Reusable template fragments.

Create `templates/partials/header.ejs`:

<Code
  code={
    `<header>
    <nav>
      <a href="/">Home</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
      
      <% if (user) { %>
        <a href="/profile">Profile</a>
        <a href="/logout">Logout</a>
      <% } else { %>
        <a href="/login">Login</a>
      <% } %>
    </nav>
</header>`
  }
  lang='html'
  title='pages/home.ejs'
/>

### Including Partials

<Code
  code={
    `<!-- Include without data -->
<%- include('partials/header') %>

<!-- Include with data -->
<%- include('partials/card', { title: 'Card Title', content: 'Card content' }) %>`
  }
  lang='html'
  title='pages/home.ejs'
/>

{/* 
## Working with Forms

### Form Template

```html
<!-- templates/pages/contact.ejs -->
<h1>Contact Us</h1>

<% if (errors && errors.length > 0) { %>
  <div class="errors">
    <ul>
      <% errors.forEach(error => { %>
        <li><%= error %></li>
      <% }); %>
    </ul>
  </div>
<% } %>

<% if (success) { %>
  <div class="success">
    <p>Thank you! Your message has been sent.</p>
  </div>
<% } %>

<form method="POST" action="/contact">
  <div class="form-group">
    <label for="name">Name:</label>
    <input 
      type="text" 
      id="name" 
      name="name" 
      value="<%= formData?.name || '' %>"
      required
    >
  </div>
  
  <div class="form-group">
    <label for="email">Email:</label>
    <input 
      type="email" 
      id="email" 
      name="email" 
      value="<%= formData?.email || '' %>"
      required
    >
  </div>
  
  <div class="form-group">
    <label for="message">Message:</label>
    <textarea 
      id="message" 
      name="message" 
      required
    ><%= formData?.message || '' %></textarea>
  </div>
  
  <button type="submit">Send Message</button>
</form>
```

### Form Controller

```typescript
const showContactForm: ControllerType = (question, reply) => {
  render(reply, 'pages/contact.ejs', {
    layout: 'layouts/base.ejs',
    title: 'Contact Us',
    errors: [],
    success: false,
    formData: {},
  });
};

const submitContactForm: ControllerType = (question, reply) => {
  const { name, email, message } = question.body();
  const errors = [];
  
  // Validation
  if (!name || name.length < 2) {
    errors.push('Name must be at least 2 characters');
  }
  if (!email || !email.includes('@')) {
    errors.push('Valid email is required');
  }
  if (!message || message.length < 10) {
    errors.push('Message must be at least 10 characters');
  }
  
  if (errors.length > 0) {
    return render(reply, 'pages/contact.ejs', {
      layout: 'layouts/base.ejs',
      title: 'Contact Us',
      errors,
      success: false,
      formData: { name, email, message },
    });
  }
  
  // Process form (send email, save to database, etc.)
  
  render(reply, 'pages/contact.ejs', {
    layout: 'layouts/base.ejs',
    title: 'Contact Us',
    errors: [],
    success: true,
    formData: {},
  });
};
```

## Best Practices

### 1. Always Escape User Input

```html
<!-- ✅ Good - escaped -->
<p><%= userInput %></p>

<!-- ❌ Bad - XSS vulnerability -->
<p><%- userInput %></p>
```

**Only use `<%-` for HTML you control.**

### 2. Keep Logic Simple

```html
<!-- ❌ Bad - too much logic -->
<% 
  const filteredUsers = users
    .filter(u => u.isActive)
    .sort((a, b) => a.name.localeCompare(b.name))
    .map(u => ({ ...u, fullName: `${u.firstName} ${u.lastName}` }));
%>

<!-- ✅ Good - logic in controller -->
<% filteredUsers.forEach(user => { %>
  <p><%= user.fullName %></p>
<% }); %>
```

### 3. Use Partials for Reusability

```html
<!-- ✅ Good -->
<%- include('../partials/user-card', { user }) %>

<!-- ❌ Bad - repeated code -->
<div class="user-card">
  <!-- Same HTML repeated everywhere -->
</div>
```

### 4. Provide Default Values

```html
<title><%= title || 'Default Title' %></title>

<% const user = locals.user || null; %>
```

### 5. Organize Templates Logically

```
templates/
├── layouts/
│   ├── base.ejs
│   └── admin.ejs
├── partials/
│   ├── header.ejs
│   ├── footer.ejs
│   └── user-card.ejs
└── pages/
    ├── home.ejs
    ├── about.ejs
    └── blog/
        ├── list.ejs
        └── post.ejs
```

### 6. Handle Missing Data

```html
<% if (user) { %>
  <p>Welcome, <%= user.name %>!</p>
<% } else { %>
  <p>Welcome, Guest!</p>
<% } %>
```

## Static Assets

### Serving Static Files

```
public/
├── css/
│   └── style.css
├── js/
│   └── main.js
└── images/
    └── logo.png
```

**In templates:**
```html
<link rel="stylesheet" href="/css/style.css">
<script src="/js/main.js"></script>
<img src="/images/logo.png" alt="Logo">
```

## Error Handling

### 404 Page

```html
<!-- templates/pages/404.ejs -->
<!DOCTYPE html>
<html>
<head>
  <title>404 - Page Not Found</title>
</head>
<body>
  <h1>404 - Page Not Found</h1>
  <p>The page you're looking for doesn't exist.</p>
  <a href="/">Go Home</a>
</body>
</html>
```

**Controller:**
```typescript
const notFound: ControllerType = (question, reply) => {
  render(reply, 'pages/404.ejs', {
    status: 404,
  });
};
```
*/}

## Next Steps

Now that you understand template rendering:

- **[Plan](/guides/future-plans/)** - Check the status of the project
