---
title: Template Rendering
description: Render dynamic HTML pages with EJS templates
---

{/* # Template Rendering */}

structure-ts uses EJS (Embedded JavaScript) for rendering dynamic HTML pages. This guide covers everything you need to build server-side rendered applications.


#### Upcomming
{/* ## What is Template Rendering? 

**Template rendering** generates HTML dynamically on the server:
- Mix HTML with JavaScript
- Pass data from controllers to templates
- Create reusable layouts and components
- Build traditional web applications

## Setting Up Templates

### Configure Template Directory

In `src/settings.ts`:

```typescript
const TEMPLATE_DIR = 'templates';
```

This tells structure-ts where to find your templates.

### Create Template Directory

```bash
mkdir templates
mkdir templates/layouts
mkdir templates/partials
mkdir templates/pages
```

**Structure:**
```
templates/
├── layouts/
│   └── base.ejs         # Main layout
├── partials/
│   ├── header.ejs       # Reusable header
│   └── footer.ejs       # Reusable footer
└── pages/
    ├── home.ejs         # Home page
    └── about.ejs        # About page
```

## Your First Template

### Step 1: Create a Template

Create `templates/pages/home.ejs`:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome</title>
</head>
<body>
  <h1>Hello, World!</h1>
  <p>Welcome to structure-ts!</p>
</body>
</html>
```

### Step 2: Render from Controller

```typescript
// src/pages/controllers.ts
import { type ControllerType, render } from 'structure-ts';

const homeController: ControllerType = (request, reply) => {
  render(reply, 'pages/home.ejs');
};

export { homeController };
```

### Step 3: Add Route

```typescript
// src/pages/routes.ts
import { Router } from 'structure-ts';
import { homeController } from './controllers';

const { routes, route } = Router();

route.get('/', homeController);

export default routes;
```

### Step 4: Test It

Visit `http://localhost:2000/pages/` to see your page!

## Passing Data to Templates

### From Controller

```typescript
const homeController: ControllerType = (request, reply) => {
  render(reply, 'pages/home.ejs', {
    title: 'Welcome',
    user: {
      name: 'Alice',
      email: 'alice@example.com',
    },
    isLoggedIn: true,
  });
};
```

### In Template

```html
<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
</head>
<body>
  <h1>Hello, <%= user.name %>!</h1>
  <p>Email: <%= user.email %></p>
  
  <% if (isLoggedIn) { %>
    <p>You are logged in!</p>
  <% } else { %>
    <p>Please log in.</p>
  <% } %>
</body>
</html>
```

## EJS Syntax

### Output Data

**Escaped output (safe HTML):**
```html
<%= value %>
```

Converts special characters:
- `<` becomes `&lt;`
- `>` becomes `&gt;`
- `&` becomes `&amp;`

**Unescaped output (raw HTML):**
```html
<%- value %>
```

Use for trusted HTML content.

**Example:**
```html
<!-- Escaped - safe from XSS -->
<p><%= userInput %></p>

<!-- Unescaped - for HTML you control -->
<div><%- articleContent %></div>
```

### JavaScript Code

**Execute code without output:**
```html
<% const greeting = 'Hello'; %>
<% const user = { name: 'Alice' }; %>
```

### Comments

```html
<%# This is a comment - not rendered in HTML %>
```

## Control Flow

### If Statements

```html
<% if (user.isAdmin) { %>
  <a href="/admin">Admin Panel</a>
<% } %>

<% if (user.role === 'admin') { %>
  <p>Welcome, Admin!</p>
<% } else if (user.role === 'moderator') { %>
  <p>Welcome, Moderator!</p>
<% } else { %>
  <p>Welcome, User!</p>
<% } %>
```

### Loops

**Array iteration:**
```html
<ul>
  <% users.forEach(user => { %>
    <li><%= user.name %> - <%= user.email %></li>
  <% }); %>
</ul>
```

**For loop:**
```html
<% for (let i = 0; i < items.length; i++) { %>
  <p>Item <%= i + 1 %>: <%= items[i] %></p>
<% } %>
```

**Object iteration:**
```html
<% Object.keys(settings).forEach(key => { %>
  <p><%= key %>: <%= settings[key] %></p>
<% }); %>
```

### Ternary Operator

```html
<p>Status: <%= user.isActive ? 'Active' : 'Inactive' %></p>

<button class="<%= isPremium ? 'btn-gold' : 'btn-standard' %>">
  <%= isPremium ? 'Premium User' : 'Free User' %>
</button>
```

## Layouts

Layouts provide consistent structure across pages.

### Base Layout

Create `templates/layouts/base.ejs`:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title || 'My App' %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('../partials/header') %>
  
  <main>
    <%- body %>
  </main>
  
  <%- include('../partials/footer') %>
  
  <script src="/js/main.js"></script>
</body>
</html>
```

### Using Layout

```typescript
const homeController: ControllerType = (request, reply) => {
  render(reply, 'pages/home.ejs', {
    layout: 'layouts/base.ejs',
    title: 'Home Page',
    content: 'Welcome to the home page!',
  });
};
```

### Page Content

```html
<!-- pages/home.ejs -->
<h1>Welcome Home!</h1>
<p><%= content %></p>
```

**Rendered output uses base layout** with page content injected at `<%- body %>`.

## Partials

Reusable template fragments.

### Header Partial

Create `templates/partials/header.ejs`:

```html
<header>
  <nav>
    <a href="/">Home</a>
    <a href="/about">About</a>
    <a href="/contact">Contact</a>
    
    <% if (user) { %>
      <a href="/profile">Profile</a>
      <a href="/logout">Logout</a>
    <% } else { %>
      <a href="/login">Login</a>
    <% } %>
  </nav>
</header>
```

### Footer Partial

Create `templates/partials/footer.ejs`:

```html
<footer>
  <p>&copy; <%= new Date().getFullYear() %> My Company</p>
  <p>
    <a href="/privacy">Privacy</a> |
    <a href="/terms">Terms</a>
  </p>
</footer>
```

### Including Partials

```html
<!-- Include without data -->
<%- include('../partials/header') %>

<!-- Include with data -->
<%- include('../partials/card', { title: 'Card Title', content: 'Card content' }) %>
```

### Reusable Card Partial

Create `templates/partials/card.ejs`:

```html
<div class="card">
  <h3><%= title %></h3>
  <p><%= content %></p>
</div>
```

**Use it:**
```html
<% posts.forEach(post => { %>
  <%- include('../partials/card', { 
    title: post.title, 
    content: post.excerpt 
  }) %>
<% }); %>
```

## Complete Example: Blog

### Controller

```typescript
// src/blog/controllers.ts
import { type ControllerType, render } from 'structure-ts';

export const listPosts: ControllerType = async (request, reply) => {
  const posts = [
    {
      id: 1,
      title: 'Getting Started with structure-ts',
      excerpt: 'Learn how to build web apps quickly...',
      author: 'Alice',
      date: new Date('2024-01-15'),
    },
    {
      id: 2,
      title: 'Advanced Routing Techniques',
      excerpt: 'Master dynamic routes and parameters...',
      author: 'Bob',
      date: new Date('2024-01-20'),
    },
  ];
  
  render(reply, 'pages/blog.ejs', {
    layout: 'layouts/base.ejs',
    title: 'Blog',
    posts,
    user: request.user || null,
  });
};

export const viewPost: ControllerType = async (request, reply) => {
  const { id } = request.params;
  
  const post = {
    id: parseInt(id),
    title: 'Getting Started with structure-ts',
    content: '<p>Full article content here...</p>',
    author: 'Alice',
    date: new Date('2024-01-15'),
    comments: [
      { author: 'Bob', text: 'Great article!', date: new Date() },
      { author: 'Charlie', text: 'Very helpful!', date: new Date() },
    ],
  };
  
  render(reply, 'pages/post.ejs', {
    layout: 'layouts/base.ejs',
    title: post.title,
    post,
    user: request.user || null,
  });
};
```

### Blog List Template

```html
<!-- templates/pages/blog.ejs -->
<h1>Blog Posts</h1>

<% if (posts.length === 0) { %>
  <p>No posts yet. Check back soon!</p>
<% } else { %>
  <div class="posts">
    <% posts.forEach(post => { %>
      <article class="post-card">
        <h2><a href="/blog/<%= post.id %>"><%= post.title %></a></h2>
        <p class="meta">
          By <%= post.author %> on <%= post.date.toLocaleDateString() %>
        </p>
        <p><%= post.excerpt %></p>
        <a href="/blog/<%= post.id %>" class="read-more">Read More →</a>
      </article>
    <% }); %>
  </div>
<% } %>
```

### Single Post Template

```html
<!-- templates/pages/post.ejs -->
<article class="post">
  <h1><%= post.title %></h1>
  <p class="meta">
    By <%= post.author %> on <%= post.date.toLocaleDateString() %>
  </p>
  
  <div class="content">
    <%- post.content %>
  </div>
  
  <section class="comments">
    <h2>Comments (<%= post.comments.length %>)</h2>
    
    <% if (post.comments.length === 0) { %>
      <p>No comments yet. Be the first!</p>
    <% } else { %>
      <% post.comments.forEach(comment => { %>
        <div class="comment">
          <p class="author"><%= comment.author %></p>
          <p><%= comment.text %></p>
          <p class="date"><%= comment.date.toLocaleDateString() %></p>
        </div>
      <% }); %>
    <% } %>
    
    <% if (user) { %>
      <form method="POST" action="/blog/<%= post.id %>/comment">
        <textarea name="text" placeholder="Add a comment..."></textarea>
        <button type="submit">Post Comment</button>
      </form>
    <% } else { %>
      <p><a href="/login">Login</a> to comment</p>
    <% } %>
  </section>
</article>

<a href="/blog">← Back to Blog</a>
```

## Working with Forms

### Form Template

```html
<!-- templates/pages/contact.ejs -->
<h1>Contact Us</h1>

<% if (errors && errors.length > 0) { %>
  <div class="errors">
    <ul>
      <% errors.forEach(error => { %>
        <li><%= error %></li>
      <% }); %>
    </ul>
  </div>
<% } %>

<% if (success) { %>
  <div class="success">
    <p>Thank you! Your message has been sent.</p>
  </div>
<% } %>

<form method="POST" action="/contact">
  <div class="form-group">
    <label for="name">Name:</label>
    <input 
      type="text" 
      id="name" 
      name="name" 
      value="<%= formData?.name || '' %>"
      required
    >
  </div>
  
  <div class="form-group">
    <label for="email">Email:</label>
    <input 
      type="email" 
      id="email" 
      name="email" 
      value="<%= formData?.email || '' %>"
      required
    >
  </div>
  
  <div class="form-group">
    <label for="message">Message:</label>
    <textarea 
      id="message" 
      name="message" 
      required
    ><%= formData?.message || '' %></textarea>
  </div>
  
  <button type="submit">Send Message</button>
</form>
```

### Form Controller

```typescript
const showContactForm: ControllerType = (request, reply) => {
  render(reply, 'pages/contact.ejs', {
    layout: 'layouts/base.ejs',
    title: 'Contact Us',
    errors: [],
    success: false,
    formData: {},
  });
};

const submitContactForm: ControllerType = (request, reply) => {
  const { name, email, message } = request.body;
  const errors = [];
  
  // Validation
  if (!name || name.length < 2) {
    errors.push('Name must be at least 2 characters');
  }
  if (!email || !email.includes('@')) {
    errors.push('Valid email is required');
  }
  if (!message || message.length < 10) {
    errors.push('Message must be at least 10 characters');
  }
  
  if (errors.length > 0) {
    return render(reply, 'pages/contact.ejs', {
      layout: 'layouts/base.ejs',
      title: 'Contact Us',
      errors,
      success: false,
      formData: { name, email, message },
    });
  }
  
  // Process form (send email, save to database, etc.)
  
  render(reply, 'pages/contact.ejs', {
    layout: 'layouts/base.ejs',
    title: 'Contact Us',
    errors: [],
    success: true,
    formData: {},
  });
};
```

## Best Practices

### 1. Always Escape User Input

```html
<!-- ✅ Good - escaped -->
<p><%= userInput %></p>

<!-- ❌ Bad - XSS vulnerability -->
<p><%- userInput %></p>
```

**Only use `<%-` for HTML you control.**

### 2. Keep Logic Simple

```html
<!-- ❌ Bad - too much logic -->
<% 
  const filteredUsers = users
    .filter(u => u.isActive)
    .sort((a, b) => a.name.localeCompare(b.name))
    .map(u => ({ ...u, fullName: `${u.firstName} ${u.lastName}` }));
%>

<!-- ✅ Good - logic in controller -->
<% filteredUsers.forEach(user => { %>
  <p><%= user.fullName %></p>
<% }); %>
```

### 3. Use Partials for Reusability

```html
<!-- ✅ Good -->
<%- include('../partials/user-card', { user }) %>

<!-- ❌ Bad - repeated code -->
<div class="user-card">
  <!-- Same HTML repeated everywhere -->
</div>
```

### 4. Provide Default Values

```html
<title><%= title || 'Default Title' %></title>

<% const user = locals.user || null; %>
```

### 5. Organize Templates Logically

```
templates/
├── layouts/
│   ├── base.ejs
│   └── admin.ejs
├── partials/
│   ├── header.ejs
│   ├── footer.ejs
│   └── user-card.ejs
└── pages/
    ├── home.ejs
    ├── about.ejs
    └── blog/
        ├── list.ejs
        └── post.ejs
```

### 6. Handle Missing Data

```html
<% if (user) { %>
  <p>Welcome, <%= user.name %>!</p>
<% } else { %>
  <p>Welcome, Guest!</p>
<% } %>
```

## Static Assets

### Serving Static Files

```
public/
├── css/
│   └── style.css
├── js/
│   └── main.js
└── images/
    └── logo.png
```

**In templates:**
```html
<link rel="stylesheet" href="/css/style.css">
<script src="/js/main.js"></script>
<img src="/images/logo.png" alt="Logo">
```

## Error Handling

### 404 Page

```html
<!-- templates/pages/404.ejs -->
<!DOCTYPE html>
<html>
<head>
  <title>404 - Page Not Found</title>
</head>
<body>
  <h1>404 - Page Not Found</h1>
  <p>The page you're looking for doesn't exist.</p>
  <a href="/">Go Home</a>
</body>
</html>
```

**Controller:**
```typescript
const notFound: ControllerType = (request, reply) => {
  render(reply, 'pages/404.ejs', {
    status: 404,
  });
};
```

## Next Steps

Now that you understand template rendering:

- **[Controllers](/guides/controllers/)** - Pass data to templates
- **[Routing](/guides/routing/)** - Connect URLs to templates
- **[Models](/guides/models/)** - Fetch data for templates

*/}
---

<small>
**Documentation Notice**: The majority of this documentation was created with assistance from Claude (Anthropic AI) and refined with modifications by Rahul Roy, the project owner. We believe in transparency about our development process.
</small>